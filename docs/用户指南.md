# ç”¨æˆ·æŒ‡å—

## ğŸ“– æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å…¨é¢äº†è§£å’Œä½¿ç”¨Project-é’å¾®æœåŠ¡å¹³å°ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åŠŸèƒ½ï¼Œæä¾›è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ ç›®æ ‡ç”¨æˆ·

- **åç«¯å¼€å‘è€…** - ä½¿ç”¨å¹³å°è¿›è¡Œå¾®æœåŠ¡å¼€å‘
- **æ¶æ„å¸ˆ** - äº†è§£ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡ç†å¿µ
- **è¿ç»´å·¥ç¨‹å¸ˆ** - éƒ¨ç½²å’Œç»´æŠ¤ç³»ç»Ÿ
- **äº§å“ç»ç†** - äº†è§£å¹³å°åŠŸèƒ½å’Œä¸šåŠ¡ä»·å€¼

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„

Project-é’é‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)å’Œå…­è¾¹å½¢æ¶æ„ï¼Œæ„å»ºäº†é«˜å†…èšã€ä½è€¦åˆçš„å¾®æœåŠ¡ä½“ç³»ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   åº”ç”¨æœåŠ¡å±‚ (Application)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    é¢†åŸŸå±‚ (Domain)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  åŸºç¡€è®¾æ–½å±‚ (Infrastructure)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **æœåŠ¡ç½‘å…³** | ç»Ÿä¸€å…¥å£ã€è·¯ç”±ã€é™æµ | Spring Cloud Gateway |
| **æ³¨å†Œä¸­å¿ƒ** | æœåŠ¡å‘ç°ä¸æ³¨å†Œ | Nacos |
| **é…ç½®ä¸­å¿ƒ** | ç»Ÿä¸€é…ç½®ç®¡ç† | Nacos Config |
| **è®¤è¯ä¸­å¿ƒ** | ç»Ÿä¸€èº«ä»½è®¤è¯ | SA-Token + JWT |
| **ç›‘æ§ä¸­å¿ƒ** | ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦ | Prometheus + Grafana |

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### ç¯å¢ƒè¦æ±‚

- **JDK**: 17+
- **Maven**: 3.8+
- **Docker**: 20.10+
- **Node.js**: 16+ (å‰ç«¯å¼€å‘)

### æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º

#### 1. å…‹éš†é¡¹ç›®

```bash
# åç«¯é¡¹ç›®
git clone https://github.com/stanic-xyz/qing.git
# æˆ–è€…ä½¿ç”¨ Gitee
# git clone https://gitee.com/stanic-xyz/qing.git
cd qing

# å‰ç«¯é¡¹ç›®ï¼ˆå¯é€‰ï¼‰
git clone https://github.com/stanic-xyz/qing-frontend.git
# æˆ–è€…ä½¿ç”¨ Gitee
# git clone https://gitee.com/stanic-xyz/qing-frontend.git
```

#### 2. å¯åŠ¨åŸºç¡€è®¾æ–½

```bash
# å¯åŠ¨ MySQLã€Redisã€Nacos ç­‰åŸºç¡€æœåŠ¡
docker-compose -f scripts/docker-compose-infra.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f scripts/docker-compose-infra.yml ps
```

#### 3. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
mysql -h localhost -P 3306 -u root -p < scripts/init-db.sql
```

#### 4. ç¼–è¯‘é¡¹ç›®

```bash
# ç¼–è¯‘æ‰€æœ‰æ¨¡å—
mvn clean install -DskipTests

# æˆ–è€…ç¼–è¯‘æŒ‡å®šæ¨¡å—
mvn clean install -pl qing-services/qing-service-auth -am
```

#### 5. å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Mavenå¯åŠ¨
mvn spring-boot:run -pl qing-services/qing-service-auth
mvn spring-boot:run -pl qing-service-cloud-gateway

# æ–¹å¼2ï¼šä½¿ç”¨JARåŒ…å¯åŠ¨
java -jar qing-services/qing-service-auth/target/*.jar
java -jar qing-service-cloud-gateway/target/*.jar
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### ä»£ç ç”Ÿæˆå™¨

ä»£ç ç”Ÿæˆå™¨æ˜¯å¹³å°çš„æ ¸å¿ƒå·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆæ ‡å‡†çš„DDDä»£ç ç»“æ„ã€‚

#### åŸºæœ¬ä½¿ç”¨

1. **å®šä¹‰å®ä½“ç±»**

```java
@Entity
@GenCode
public class Product {
    @Id
    private Long id;
    
    @GenField(label = "äº§å“åç§°")
    private String name;
    
    @GenField(label = "ä»·æ ¼")
    private BigDecimal price;
    
    // getter/setter...
}
```

2. **ç¼–è¯‘ç”Ÿæˆä»£ç **

```bash
mvn compile
```

3. **ç”Ÿæˆçš„ä»£ç ç»“æ„**

```
src/main/java/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ ProductController.java      # RESTæ§åˆ¶å™¨
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ IProductService.java        # æœåŠ¡æ¥å£
â”‚   â””â”€â”€ impl/ProductServiceImpl.java # æœåŠ¡å®ç°
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ ProductRepository.java      # æ•°æ®ä»“å‚¨
â””â”€â”€ dto/
    â”œâ”€â”€ ProductCreateRequest.java   # åˆ›å»ºè¯·æ±‚DTO
    â”œâ”€â”€ ProductUpdateRequest.java   # æ›´æ–°è¯·æ±‚DTO
    â””â”€â”€ ProductResponse.java        # å“åº”DTO
```

#### é«˜çº§é…ç½®

```java
@Entity
@GenCode(
    moduleName = "product",           // æ¨¡å—å
    packageName = "com.example",      // åŒ…å
    author = "å¼ ä¸‰",                  // ä½œè€…
    tableComment = "äº§å“ç®¡ç†"          // è¡¨æ³¨é‡Š
)
public class Product {
    @GenField(
        label = "äº§å“åç§°",
        required = true,              // å¿…å¡«
        length = 100,                // é•¿åº¦é™åˆ¶
        comment = "äº§å“çš„æ˜¾ç¤ºåç§°"      // å­—æ®µæ³¨é‡Š
    )
    private String name;
}
```

### è®¤è¯ä¸æˆæƒ

#### ç”¨æˆ·ç™»å½•

```bash
# ç™»å½•æ¥å£
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "rawPassword": "123456"
}

# å“åº”
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "id": 1,
      "username": "admin",
      "roles": ["ADMIN"]
    }
  }
}
```

#### æ¥å£è°ƒç”¨

```bash
# åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦token
GET /api/products
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### æƒé™æ§åˆ¶

```java
@RestController
@RequestMapping("/api/products")
public class ProductController {
    
    @GetMapping
    @SaCheckRole("USER")  // éœ€è¦USERè§’è‰²
    public List<Product> list() {
        return productService.list();
    }
    
    @PostMapping
    @SaCheckPermission("product:create")  // éœ€è¦åˆ›å»ºæƒé™
    public Product create(@RequestBody ProductCreateRequest request) {
        return productService.create(request);
    }
}
```

### æ•°æ®åº“æ“ä½œ

#### JPA Repository

```java
@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    
    // æ ¹æ®åç§°æŸ¥è¯¢
    List<Product> findByNameContaining(String name);
    
    // æ ¹æ®ä»·æ ¼èŒƒå›´æŸ¥è¯¢
    @Query("SELECT p FROM Product p WHERE p.price BETWEEN :minPrice AND :maxPrice")
    List<Product> findByPriceRange(@Param("minPrice") BigDecimal minPrice, 
                                  @Param("maxPrice") BigDecimal maxPrice);
    
    // åˆ†é¡µæŸ¥è¯¢
    Page<Product> findByStatus(ProductStatus status, Pageable pageable);
}
```

#### äº‹åŠ¡ç®¡ç†

```java
@Service
@Transactional
public class ProductServiceImpl implements IProductService {
    
    @Override
    public Product create(ProductCreateRequest request) {
        // ä¸šåŠ¡é€»è¾‘
        Product product = new Product();
        BeanUtils.copyProperties(request, product);
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        return productRepository.save(product);
    }
    
    @Override
    @Transactional(rollbackFor = Exception.class)
    public void batchUpdate(List<ProductUpdateRequest> requests) {
        // æ‰¹é‡æ›´æ–°æ“ä½œ
        requests.forEach(request -> {
            Product product = productRepository.findById(request.getId())
                .orElseThrow(() -> new BusinessException("äº§å“ä¸å­˜åœ¨"));
            BeanUtils.copyProperties(request, product);
            productRepository.save(product);
        });
    }
}
```

### APIæ–‡æ¡£

ç³»ç»Ÿé›†æˆäº†Knife4jï¼Œæä¾›äº†ç¾è§‚çš„APIæ–‡æ¡£ç•Œé¢ã€‚

#### è®¿é—®æ–‡æ¡£

- **å¼€å‘ç¯å¢ƒ**: http://localhost:8080/doc.html
- **æµ‹è¯•ç¯å¢ƒ**: http://test.example.com/doc.html

#### æ¥å£æ³¨è§£

```java
@RestController
@RequestMapping("/api/products")
@Api(tags = "äº§å“ç®¡ç†")
public class ProductController {
    
    @GetMapping
    @ApiOperation("æŸ¥è¯¢äº§å“åˆ—è¡¨")
    @ApiImplicitParams({
        @ApiImplicitParam(name = "name", value = "äº§å“åç§°", paramType = "query"),
        @ApiImplicitParam(name = "status", value = "äº§å“çŠ¶æ€", paramType = "query")
    })
    public Result<List<ProductResponse>> list(
        @RequestParam(required = false) String name,
        @RequestParam(required = false) ProductStatus status) {
        // å®ç°é€»è¾‘
    }
}
```

## ğŸ” ç›‘æ§ä¸è¿ç»´

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
GET /actuator/health

# å“åº”
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "validationQuery": "isValid()"
      }
    },
    "redis": {
      "status": "UP",
      "details": {
        "version": "6.2.6"
      }
    }
  }
}
```

### æ€§èƒ½æŒ‡æ ‡

```bash
# æŸ¥çœ‹JVMæŒ‡æ ‡
GET /actuator/metrics/jvm.memory.used

# æŸ¥çœ‹HTTPè¯·æ±‚æŒ‡æ ‡
GET /actuator/metrics/http.server.requests
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ—¥å¿—çº§åˆ«
GET /actuator/loggers

# åŠ¨æ€ä¿®æ”¹æ—¥å¿—çº§åˆ«
POST /actuator/loggers/com.example.service
Content-Type: application/json

{
  "configuredLevel": "DEBUG"
}
```

## ğŸ› ï¸ å¼€å‘æœ€ä½³å®è·µ

### ä»£ç è§„èŒƒ

1. **åŒ…ç»“æ„è§„èŒƒ**

```
com.example.product/
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨å±‚
â”œâ”€â”€ service/            # æœåŠ¡å±‚
â”‚   â””â”€â”€ impl/
â”œâ”€â”€ repository/         # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ domain/            # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ entity/        # å®ä½“
â”‚   â”œâ”€â”€ vo/           # å€¼å¯¹è±¡
â”‚   â””â”€â”€ event/        # é¢†åŸŸäº‹ä»¶
â”œâ”€â”€ dto/              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ request/      # è¯·æ±‚DTO
â”‚   â””â”€â”€ response/     # å“åº”DTO
â””â”€â”€ config/           # é…ç½®ç±»
```

2. **å‘½åè§„èŒƒ**

- **ç±»å**: ä½¿ç”¨å¤§é©¼å³°å‘½åæ³•ï¼Œå¦‚ `ProductService`
- **æ–¹æ³•å**: ä½¿ç”¨å°é©¼å³°å‘½åæ³•ï¼Œå¦‚ `findByName`
- **å¸¸é‡**: ä½¿ç”¨å…¨å¤§å†™+ä¸‹åˆ’çº¿ï¼Œå¦‚ `MAX_RETRY_COUNT`
- **åŒ…å**: ä½¿ç”¨å°å†™å­—æ¯ï¼Œå¦‚ `com.example.product`

3. **å¼‚å¸¸å¤„ç†**

```java
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public Result<Void> handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return Result.fail(e.getCode(), e.getMessage());
    }
    
    @ExceptionHandler(Exception.class)
    public Result<Void> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Result.fail("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

### æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**

```java
// ä½¿ç”¨ç´¢å¼•
@Entity
@Table(indexes = {
    @Index(name = "idx_name", columnList = "name"),
    @Index(name = "idx_status_created", columnList = "status,createdAt")
})
public class Product {
    // ...
}

// æ‰¹é‡æ“ä½œ
@Modifying
@Query("UPDATE Product p SET p.status = :status WHERE p.id IN :ids")
int batchUpdateStatus(@Param("status") ProductStatus status, @Param("ids") List<Long> ids);
```

2. **ç¼“å­˜ä½¿ç”¨**

```java
@Service
public class ProductService {
    
    @Cacheable(value = "products", key = "#id")
    public Product findById(Long id) {
        return productRepository.findById(id).orElse(null);
    }
    
    @CacheEvict(value = "products", key = "#product.id")
    public Product update(Product product) {
        return productRepository.save(product);
    }
}
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8080

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat application.yml

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -f logs/application.log
```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
docker ps | grep mysql

# æµ‹è¯•è¿æ¥
mysql -h localhost -P 3306 -u root -p

# æ£€æŸ¥é…ç½®
grep -A 5 "datasource" application.yml
```

3. **æ¥å£è°ƒç”¨è¶…æ—¶**

```bash
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping target-service

# æ£€æŸ¥æœåŠ¡æ³¨å†Œ
curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=product-service

# æŸ¥çœ‹è°ƒç”¨é“¾è·¯
grep "traceId" logs/application.log
```

### æ—¥å¿—åˆ†æ

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/application.log | tail -20

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µæ—¥å¿—
awk '/2024-01-01 10:00:00/,/2024-01-01 11:00:00/' logs/application.log

# ç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°
grep "ProductController" logs/application.log | wc -l
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£ä¸­å¿ƒ**: [docs/](../docs/)
- **é—®é¢˜åé¦ˆ**: [Issues](https://github.com/stanic-xyz/qing/issues)
- **æŠ€æœ¯äº¤æµ**: QQç¾¤ 123456789
- **é‚®ä»¶æ”¯æŒ**: support@example.com

## ğŸ“š ç›¸å…³èµ„æº

- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [Spring Cloud Alibabaæ–‡æ¡£](https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/zh-cn/index.html)
- [DDDé¢†åŸŸé©±åŠ¨è®¾è®¡](https://domain-driven-design.org/)
- [å…­è¾¹å½¢æ¶æ„](https://alistair.cockburn.us/hexagonal-architecture/)

---

> ğŸ’¡ **æç¤º**: å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·å…ˆæŸ¥çœ‹æœ¬æŒ‡å—çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†ï¼Œæˆ–è€…æŸ¥é˜…ç›¸å…³æŠ€æœ¯æ–‡æ¡£ã€‚å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œæ¬¢è¿æäº¤Issueæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚
